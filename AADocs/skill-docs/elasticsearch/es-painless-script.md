```
GET /ldl/dynamicperosn/_search
{
  "query": {
    "function_score": {
      "script_score": {
        "script": {
          "lang": "painless",
          "inline": "float []aa = new float[]{3.190964f,2.8307064f,-1.6741064f,-0.7158575f,1.4844592f,0.3569899f,-3.765471f,2.4731772f,0.3088535f,5.198768f,2.9061224f,3.9903145f,-1.0288097f,0.81377995f,-3.8875203f,0.68794954f,0.95916486f,-0.307535f,2.588307f,0.2618227f,-2.1189435f,-1.525757f,1.3882864f,1.4132252f,3.9770322f,-0.012118943f,2.1139445f,2.2048795f,-2.0169547f,-1.181427f,2.4821203f,0.013311122f,-3.3764212f,-2.2485962f,-5.48915f,-1.977677f,-0.91453636f,-0.27960005f,-1.2761846f,-0.81913567f,4.1003385f,2.4913256f,-0.5221159f,0.36859024f,-4.473626f,2.1434917f,1.7802329f,-1.0336457f,-0.95281136f,-1.3677506f,-0.30710495f,-0.7591817f,1.5014924f,-3.5587957f,2.7209344f,-3.6697083f,0.22013018f,2.1811633f,-0.05577451f,1.3084428f,1.6447095f,-2.0299993f,3.77942f,-1.3996943f,-1.8013473f,-5.746379f,1.8178829f,4.3182306f,2.0250282f,-2.6244543f,0.29233932f,-0.42216432f,-1.6321611f,0.64847064f,-2.875408f,-1.2852651f,-1.4024737f,-0.12404144f,-1.4796301f,-1.7646688f,-0.09437859f,0.9572205f,1.5246323f,-2.1582658f,1.6135384f,-0.058100082f,-3.178519f,-0.5270421f,0.17522328f,1.7978686f,1.4160682f,1.0207666f,-4.9372225f,-2.7976127f,2.51787f,-0.0907256f,0.92526865f,0.8243698f,0.5223757f,-5.4809f,0.65129673f,-1.7528108f,1.113587f,0.61070675f,-0.8995021f,-0.8402402f,-2.4924595f,0.3966657f,2.4169977f,-0.76239777f,-3.2062118f,-1.5897324f,-2.4737852f,-0.68642884f,-3.6652987f,-0.30897838f,2.347684f,0.64277476f,-1.8917061f,-1.024017f,0.035217345f,-0.40984297f,1.3454604f,0.7514719f,0.10202002f,1.2927659f,0.92784345f,1.3387613f,0.31596205f,1.0863957f,1.9870543f,2.1070023f,-2.1893146f,0.72752345f,1.5461373f,0.24542019f,-4.4472833f,0.6050637f,0.30557734f,4.1385217f,1.6976476f,0.955844f,-4.2375236f,-3.0134418f,-0.120928675f,1.6577469f,-0.974399f,1.1477342f,0.44975725f,-3.3231938f,-2.513576f,-1.7978077f,3.5327728f,-1.6564636f,2.8760135f,0.8320715f,5.39116f,0.9691964f,-1.4520627f,2.9465888f,-0.4445823f,-0.96410465f,-2.1935287f,-3.3668456f,2.0566914f,-1.6270707f,-0.5850611f,0.61730695f,0.3577941f,-1.4038631f,-3.6432724f,0.19213659f,-0.16591027f,0.21726185f,2.1691148f,-2.004275f,-2.644798f,-0.19366887f,1.0839443f,-2.9488156f,-0.89639175f,-1.1113838f,0.06532098f,0.9066397f,-1.7863894f,-0.5361314f,0.05176446f,1.197395f,0.47235492f,0.78142476f,1.210423f,-1.658072f,2.936545f,2.6792474f,-0.08322254f,3.6989255f,-1.9944315f,2.517653f,1.8519678f,-2.5651648f,-2.6013374f,5.367207f,-1.6395643f,1.5617886f,3.9380085f,-0.35922712f,4.634762f,2.9753275f,2.1506972f,-4.405378f,0.2807635f,1.4784008f,-1.6773125f,2.7670617f,4.40791f,0.19950584f,0.5177167f,-1.3246729f,3.8983781f,1.2687719f,0.16437085f,1.7127311f,1.3458947f,-2.7115583f,0.81917894f,3.8181283f,-0.37046695f,-0.9679807f,0.47163257f,-1.3965544f,1.4115494f,3.3317766f,-3.725687f,1.574343f,1.3006852f,1.0085192f,-0.94364357f,7.5398917f,1.3037142f,-2.2412963f,-1.023157f,1.4281324f,0.023691364f,-2.1005983f,-2.1730003f,6.463123f,-5.450161f,-0.25354356f,3.386099f,-0.8138638f,-5.9193516f,1.7401586f,-3.013549f,1.7710711f,5.0459285f,-4.3430634f,-1.4592224f,4.067426f,1.5182317f,-2.769008f,1.2213314f,4.399404f,-1.8880183f,3.0580153f,2.4261765f,1.1372633f,-0.55849767f,1.9152719f,1.7649359f,-1.3303013f,-0.4561418f,-2.3877249f,-1.1819755f,-2.0867262f,-1.4382944f,1.3481259f,1.9386531f,1.936276f,2.6496215f,-4.1381936f,-1.2256459f,2.2513413f,2.500631f,-1.1206756f,-0.13204007f,0.17590067f,0.35093325f,-4.6848054f,1.0420355f,4.7592297f,-0.81002295f,-1.025148f,-3.815786f,3.0089326f,0.7249138f,-3.1099656f,0.77818173f,0.5211841f,-0.6330313f,0.006736517f,-2.909602f,0.06203361f,-1.2299389f,-2.3369856f,2.2217793f,-3.0374284f,3.220502f,0.69729483f,-5.447157f,1.3895026f,2.5997214f,-0.846771f,4.672148f,0.46884698f,-1.8715539f,0.24393465f,-4.1778994f,0.8317637f,-0.9391846f,-3.1311579f,1.5604397f,4.1497846f,-2.0344784f,3.2705922f,-2.2311656f,-0.48199278f,-3.5317705f,1.5169194f,-3.6810942f,-0.42959845f,-1.3569856f,-4.8991985f,-0.7018162f,1.6863385f,1.4100169f,-0.85985094f,-3.695517f,-3.7919517f,1.4993325f,-2.051403f,5.0293097f,0.09630804f,0.014633618f,-0.96536523f,-0.11393353f,0.46218324f,1.9182925f,0.080610216f,-0.19931014f,2.8952248f,-4.2232156f,1.008458f,-0.6185921f,0.3017801f,-3.5039606f,0.8957078f,-5.0474677f,1.770463f,-2.620433f,-1.2052803f,0.52374166f,0.47148132f,0.16691202f,-2.160719f,0.085967705f,2.6150315f,-0.19516358f,4.5386176f,-2.5202365f,-0.75459594f,0.27817103f,-1.6224566f,-1.5264845f,3.3187783f,-0.94814265f,-3.7132118f,3.070925f,0.49655968f,0.67441237f,5.278877f,-0.13611755f,1.3501796f,-3.0476713f,1.0552574f,1.2228851f,-1.3596414f,5.1391177f,-1.7877898f,3.8864017f,3.3270772f,-1.5346177f,1.4795336f,2.4888308f,-0.63767904f,-0.3711663f,1.238555f,1.9963847f,6.7823925f,-1.3016417f,1.2647381f,-1.1135467f,2.7110596f,-7.713902f,-1.3692675f,-3.3745f,3.414169f,-1.1156712f,1.1921644f,2.7529068f,-4.174129f,0.6441154f,-2.6680946f,-2.364317f,2.66339f,-0.4362219f,1.6002979f,-1.9226681f,9.192169f,1.1495445f,-1.8877145f,1.6358994f,-2.3831933f,0.14730097f,1.1036844f,-3.9746137f,-0.17928879f,-1.540889f,3.555821f,-2.90859f,3.179881f,-2.2086918f,-4.82586f,-1.5680588f,3.2609363f,-0.20201416f,-1.0817887f,0.6579228f,-1.2788484f,4.746976f,0.058608532f,4.412135f,-0.18342587f,7.3637657f,0.7480117f,0.10243121f,-2.68354f,0.44644165f,-1.9442577f,-0.45246845f,1.0310351f,-5.745306f,-1.4182227f,2.8016355f,-3.808182f,-4.1995926f,0.14831886f,0.10881665f,-2.4031763f,2.076379f,3.9403164f,2.1543593f,0.27106217f,-0.23422308f,0.02674064f,0.117301226f,3.124097f,-4.501745f,1.1011446f,4.478605f,-5.0275455f,2.7449079f,-4.9975953f,-0.40056285f,-0.33482346f,-0.04622227f,0.75970775f,5.131138f,2.2053118f,-2.0083754f,1.8336166f,2.5804827f,-3.3359f,-1.0425848f,1.0541445f,-0.37762904f,0.18198162f,2.6815495f,-4.4378843f,-0.9039538f,-3.660307f,1.0315194f,1.4394243f,3.8185036f,-0.19487579f,0.61554384f,-0.117388956f,-1.3189002f,-5.4241314f,-5.6008954f,0.18223533f,-0.44155702f,2.4824893f,-1.7837762f,3.2565649f,-3.5472844f,0.21475437f,4.1284904f,0.024271194f,-2.4572046f,1.695437f,0.92292607f,0f}; def dd = new ArrayList(); dd = params._source.feature; double similarityDegree = 0d; double currentFeatureMultiple = 0d; double historyFeatureMultiple = 0d; double aa_value = 0d; double feature_value = 0d; if(doc['feature'].length != 512){return 0} else {for(int i = 0; i < dd.size(); ++i) {aa_value = aa[i]; feature_value = dd.get(i); similarityDegree = similarityDegree + aa_value * feature_value;currentFeatureMultiple = currentFeatureMultiple + aa_value*aa_value;historyFeatureMultiple = historyFeatureMultiple + feature_value*feature_value } double tempSim = similarityDegree / Math.sqrt(currentFeatureMultiple) / Math.sqrt(historyFeatureMultiple); double actualValue = (0.5d + (tempSim / 2.0d)) * 100; if (actualValue > 100) {return 100; }return actualValue} "
        }
      }
    }
  }
}





DELETE hockey

PUT hockey/player/_bulk?refresh
{"index":{"_id":1}}
{"first":"johnny","last":"gaudreau","goals":[9,27,1],"assists":[17,46,0],"gp":[26,82,1],"born":"1993/08/13"}
{"index":{"_id":2}}
{"first":"sean","last":"monohan","goals":[7,54,26],"assists":[11,26,13],"gp":[26,82,82],"born":"1994/10/12"}
{"index":{"_id":3}}
{"first":"jiri","last":"hudler","goals":[5,34,36],"assists":[11,62,42],"gp":[24,80,79],"born":"1984/01/04"}
{"index":{"_id":4}}
{"first":"micheal","last":"frolik","goals":[4,6,15],"assists":[8,23,15],"gp":[26,82,82],"born":"1988/02/17"}
{"index":{"_id":5}}
{"first":"sam","last":"bennett","goals":[5,0,0],"assists":[8,1,0],"gp":[26,1,0],"born":"1996/06/20"}
{"index":{"_id":6}}
{"first":"dennis","last":"wideman","goals":[0,26,15],"assists":[11,30,24],"gp":[26,81,82],"born":"1983/03/20"}
{"index":{"_id":7}}
{"first":"david","last":"jones","goals":[7,19,5],"assists":[3,17,4],"gp":[26,45,34],"born":"1984/08/10"}
{"index":{"_id":8}}
{"first":"tj","last":"brodie","goals":[2,14,7],"assists":[8,42,30],"gp":[26,82,82],"born":"1990/06/07"}
{"index":{"_id":39}}
{"first":"mark","last":"giordano","goals":[6,30,15],"assists":[3,30,24],"gp":[26,60,63],"born":"1983/10/03"}
{"index":{"_id":10}}
{"first":"mikael","last":"backlund","goals":[3,15,13],"assists":[6,24,18],"gp":[26,82,82],"born":"1989/03/17"}
{"index":{"_id":11}}
{"first":"joe","last":"colborne","goals":[3,18,13],"assists":[6,20,24],"gp":[26,67,82],"born":"1990/01/30"}


GET /hockey/_search
{
  "query": {
    "function_score": {
      "script_score": {
        "script": {
          "lang": "painless",
          "inline": "def bb = new ArrayList();bb=params._source.goals; long nima = bb.get(0); long tmp = 0; for (int i = 0; i < bb.size(); i++) { tmp = bb.get(i)}return tmp;"
        }
      }
    }
  }
}

```